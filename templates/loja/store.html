<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% include 'includes/servername.html' %}</title>
    {% include 'includes/default_links.html' %}
</head>
<body>

{% include 'includes/header.html' %}

<div class="container full justify-content-center text-center slogan big-text emph margin-top-medium margin-bottom-none">
    LOJA
</div>

<div class="d-flex">
    <div class="container">
        <div class="row justify-content-center">
            {% for category in store  %}
            <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-4 justify-content-center abel text-center">
                <button class="button-primary big-height" onclick="changeCategory('{{ category.name }}')">
                    {{ category.name }}
                </button>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<div class="d-flex margin-top-medium">
    {% for category in store %}
        <div id="{{ category.name }}" class="container scrollable-container">
            <div class="row justify-content-center">

                {% for item in category.items %}
                    <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-2 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <div class="image-container" >
                                    <img src="{{ item.image_url }}" >
                                </div>
                                <h5 class="card-title abel text-center margin-top-low margin-bottom-none">{{ item.name }}</h5>
                                <p class="card-text abel text-center wiped-out margin-bottom-none">{{ item.description }}</p>
                                <div class="card-text abel text-center price">
                                    <span class="small-padding-top">R$</span>
                                    <span class="big-text">{{ item.price }}</span>
                                    <span class="small-padding-top">00</span>
                                </div>
                                <button class="button-primary small-text abel justify-content-center" onclick="addToCart({{ item.id }})">
                                    <img width="10" src="data:image/svg;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA60lEQVR4nO3WsQpBURjA8VsmKwNG5Q1MJoOFlFmKJ7BY5QHkJZTJG9ydYrPZhZXBoAh/XX1ic45z7pH4z1/n11nOdzzvJwPGPFoA1U/AQScg4wS/BwxuNHQ8lwEVgaeu4SiwB85AwjXuy60bruEm4TR6BadDglcqt56HAPdV4F4IcE0FzltGL0BSBY4AG4vw7CX6hA8twl0duG4RLujAMVkYpu2DF1EZFnxiAfa1UIHbFuDWO3AK2BmgWyCuDQueC9YkcNQAD/LByL6F/m5AGVgHGwYomc4pJwfdW5rOfQVckkOXQNF07p/nqit4etkTHpfOQQAAAABJRU5ErkJggg==">
                                    Adicionar ao carrinho
                                </button>
                            </div>
                        </div>
                    </div>
                    {% if loop.index % 6 == 0 %}
                        </div><div class="row justify-content-center">
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    {%  endfor %}
</div>

<script>
    const categories = [{% for category in store %}"{{ category.name }}",{% endfor %}]
    for(let i in categories) {
        document.getElementById(categories[i]).style.display = 'none'
    }
    document.getElementById(categories[0]).style.display = 'block'

    function changeCategory(name) {
        for(let i in categories) {
            if (categories[i] === name) {
                document.getElementById(categories[i]).style.display = 'block'
            } else {
                document.getElementById(categories[i]).style.display = 'none'
            }
        }
    }

    function addToCart(item_id) {
        const url = "{{ url_for('main.cart_add_item') }}";
        const data = new FormData();
        data.append('item_id', item_id);
        data.append('action', 'add');

        fetch(url, {
            method: 'POST',
            body: data,
            credentials: 'same-origin'
        })
        .then(response => response.json())
        .then(data => {
            showFeedback(data.message, data.status);
        })
        .catch((error) => {
            console.log('Failed: ', error);
            showFeedback('Falha ao adicionar item ao carrinho.', 'error');
        });
    }

    function showFeedback(message, status) {
        const feedback = document.getElementById('feedback');
        feedback.innerText = message;
        feedback.className = 'feedback ' + status; // Adiciona a classe de status para estilo
        feedback.style.display = 'block';
        setTimeout(() => {
            feedback.style.display = 'none';
        }, 3000);
    }

</script>

{% include 'includes/logged_scripts.html' %}

</body>
</html>