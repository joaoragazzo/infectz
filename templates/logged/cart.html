<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% include 'includes/servername.html' %}</title>
    {% include 'includes/default_links.html' %}
</head>
<body>

    {% include 'includes/header.html' %}


    <div class="container full justify-content-center text-center slogan big-text emph margin-top-medium">
        SEU CARRINHO
    </div>

    <div class="container d-flex justify-content-center align-items-end position-relative margin-top-low">
        <div class="cart text-center">
            <div class="cart-content scrollable-container">
                <div class="cart-item row p-10">
                    <div class="col-auto p-0 small-icon">
                        <div class="image-container">
                            <img src="/static/img/itens/mi17.jpg">
                        </div>
                    </div>
                    <div class="col-6 text-left flex-grow-1">
                        <div class="medium-text abel"><b>MI17</b></div>
                        <div class="small-text abel">R$ 75.00</div>
                    </div>
                    <div class="col-2 flex-grow-1 center">
                        <div class="row flex-grow-1 abel">
                            <div class="col padding-right-none">
                                <button class="button-small">
                                    +
                                </button>
                            </div>
                            <div class="col">
                                <div>
                                    1
                                </div>
                            </div>
                            <div class="col padding-left-none">
                                <button class="button-small">
                                    -
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



            <div class="row">
                <div class="col">
                    <button class="button-primary abel padding-tb-low">
                        Continuar comprando
                    </button>
                </div>
                <div class="col">
                    <button class="button-primary abel padding-tb-low">
                        Ir para o pagamento
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
    const categories = [{% for category in store %}"{{ category.name }}",{% endfor %}]
    for(let i in categories) {
        document.getElementById(categories[i]).style.display = 'none'
    }
    document.getElementById(categories[0]).style.display = 'block'

    function changeCategory(name) {
        for(let i in categories) {
            if (categories[i] === name) {
                document.getElementById(categories[i]).style.display = 'block'
            } else {
                document.getElementById(categories[i]).style.display = 'none'
            }
        }
    }

    function addToCart(item_id) {
        const url = "{{ url_for('main.cart_add_item') }}";
        const data = new FormData();
        data.append('item_id', item_id);
        data.append('action', 'add');

        fetch(url, {
            method: 'POST',
            body: data,
            credentials: 'same-origin'
        })
        .then(response => response.json())
        .then(data => {
            showFeedback(data.message, data.status);
        })
        .catch((error) => {
            console.log('Failed: ', error);
            showFeedback('Falha ao adicionar item ao carrinho.', 'error');
        });
    }

    function removeFromCart(item_id) {
        const url = "{{ url_for('main.cart_add_item') }}";
        const data = new FormData();
        data.append('item_id', item_id);
        data.append('action', 'remove');

        fetch(url, {
            method: 'POST',
            body: data,
            credentials: 'same-origin'
        })
        .then(response => response.json())
        .then(data => {
            showFeedback(data.message, data.status);
        })
        .catch((error) => {
            console.log('Failed: ', error);
            showFeedback('Falha ao remover item do carrinho.', 'error');
        });
    }

    function showFeedback(message, status) {
        const feedback = document.getElementById('feedback');
        feedback.innerText = message;
        feedback.className = 'feedback ' + status;
        feedback.style.display = 'block';
        setTimeout(() => {
            feedback.style.display = 'none';
        }, 3000);
    }
</script>

    {% include 'includes/logged_scripts.html' %}
</body>
</html>